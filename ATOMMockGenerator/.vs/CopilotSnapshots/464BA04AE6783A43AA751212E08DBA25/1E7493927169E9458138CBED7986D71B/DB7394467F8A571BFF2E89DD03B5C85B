import axios from 'axios';
import type { JsonConfig, ValidationResult, WiremockMapping } from '../types';

const api = axios.create({
  baseURL: '/api',
  timeout: 30000,
});

export const configService = {
  async validateConfig(config: JsonConfig): Promise<ValidationResult> {
    const response = await api.post<ValidationResult>('/config/validate', config);
    return response.data;
  },

  async generateMappings(config: JsonConfig): Promise<WiremockMapping[]> {
    const response = await api.post<WiremockMapping[]>('/config/generate-mappings', config);
    return response.data;
  },

  async downloadTemplate(): Promise<Blob> {
    const response = await api.get('/config/template', {
      responseType: 'blob',
    });
    return response.data;
  },
};

export const mappingService = {
  async getAllMappings(): Promise<WiremockMapping[]> {
    const response = await api.get<WiremockMapping[]>('/mappings');
    return response.data;
  },

  async deleteMapping(id: string): Promise<void> {
    await api.delete(`/mappings/${id}`);
  },

  async updateMapping(id: string, mapping: WiremockMapping): Promise<WiremockMapping> {
    const response = await api.put<WiremockMapping>(`/mappings/${id}`, mapping);
    return response.data;
  },

  async downloadMappings(mappingIds: string[]): Promise<Blob> {
    const response = await api.post('/mappings/download', { mappingIds }, {
      responseType: 'blob',
    });
    return response.data;
  },
};

export default api;